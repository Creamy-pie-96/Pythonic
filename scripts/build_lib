#!/bin/bash
set -e

ROOT_DIR="$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")/.." && pwd)"

BUILD_DIR="$ROOT_DIR/build"
INSTALL_DIR="$ROOT_DIR/install"

# Safety check before rm -rf
if [[ -z "$BUILD_DIR" || "$BUILD_DIR" == "/" ]]; then
  echo "Refusing to delete unsafe BUILD_DIR: '$BUILD_DIR'"
  exit 1
fi

rm -rf "$BUILD_DIR"
mkdir -p "$BUILD_DIR"
cd "$BUILD_DIR"

cmake "$ROOT_DIR" \
  -DCMAKE_INSTALL_PREFIX="$INSTALL_DIR" \
  -DPYTHONIC_ENABLE_GRAPH_VIEWER=ON

cmake --build . -j$(nproc)
cmake --install .

echo
echo "âœ” Clean build + install complete"
echo "  Install prefix: $INSTALL_DIR"
