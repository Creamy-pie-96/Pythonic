/**
 * @file Font.hpp
 * @brief Pixel font for terminal graphics text rendering
 *
 * Uses the same 3x5 pixel font from pythonicPlot for consistency.
 */

#pragma once

#include "../Config.hpp"
#include "../Core/Color.hpp"
#include <map>
#include <string>
#include <cstdint>

TG_NAMESPACE_BEGIN

/**
 * @brief Namespace containing pixel fonts for terminal graphics
 */
namespace font
{

    /**
     * @brief A single character glyph (3 pixels wide x 5 pixels tall)
     *
     * Each row is a 3-bit pattern where:
     * - Bit 2 = leftmost pixel
     * - Bit 1 = middle pixel
     * - Bit 0 = rightmost pixel
     */
    struct Glyph
    {
        uint8_t rows[5];

        constexpr Glyph() : rows{0, 0, 0, 0, 0} {}
        constexpr Glyph(uint8_t r0, uint8_t r1, uint8_t r2, uint8_t r3, uint8_t r4)
            : rows{r0, r1, r2, r3, r4} {}
    };

    /**
     * @brief Get the default 3x5 pixel font
     * @return Reference to font glyph map
     */
    inline const std::map<char, Glyph> &getDefaultFont()
    {
        static std::map<char, Glyph> font = {
            // Numbers
            {'0', {0b111, 0b101, 0b101, 0b101, 0b111}},
            {'1', {0b010, 0b110, 0b010, 0b010, 0b111}},
            {'2', {0b111, 0b001, 0b111, 0b100, 0b111}},
            {'3', {0b111, 0b001, 0b111, 0b001, 0b111}},
            {'4', {0b101, 0b101, 0b111, 0b001, 0b001}},
            {'5', {0b111, 0b100, 0b111, 0b001, 0b111}},
            {'6', {0b111, 0b100, 0b111, 0b101, 0b111}},
            {'7', {0b111, 0b001, 0b001, 0b001, 0b001}},
            {'8', {0b111, 0b101, 0b111, 0b101, 0b111}},
            {'9', {0b111, 0b101, 0b111, 0b001, 0b111}},

            // Uppercase letters
            {'A', {0b010, 0b101, 0b111, 0b101, 0b101}},
            {'B', {0b110, 0b101, 0b110, 0b101, 0b110}},
            {'C', {0b011, 0b100, 0b100, 0b100, 0b011}},
            {'D', {0b110, 0b101, 0b101, 0b101, 0b110}},
            {'E', {0b111, 0b100, 0b110, 0b100, 0b111}},
            {'F', {0b111, 0b100, 0b110, 0b100, 0b100}},
            {'G', {0b011, 0b100, 0b101, 0b101, 0b011}},
            {'H', {0b101, 0b101, 0b111, 0b101, 0b101}},
            {'I', {0b111, 0b010, 0b010, 0b010, 0b111}},
            {'J', {0b001, 0b001, 0b001, 0b101, 0b010}},
            {'K', {0b101, 0b110, 0b100, 0b110, 0b101}},
            {'L', {0b100, 0b100, 0b100, 0b100, 0b111}},
            {'M', {0b101, 0b111, 0b101, 0b101, 0b101}},
            {'N', {0b101, 0b111, 0b111, 0b101, 0b101}},
            {'O', {0b010, 0b101, 0b101, 0b101, 0b010}},
            {'P', {0b110, 0b101, 0b110, 0b100, 0b100}},
            {'Q', {0b010, 0b101, 0b101, 0b111, 0b011}},
            {'R', {0b110, 0b101, 0b110, 0b101, 0b101}},
            {'S', {0b011, 0b100, 0b010, 0b001, 0b110}},
            {'T', {0b111, 0b010, 0b010, 0b010, 0b010}},
            {'U', {0b101, 0b101, 0b101, 0b101, 0b010}},
            {'V', {0b101, 0b101, 0b101, 0b010, 0b010}},
            {'W', {0b101, 0b101, 0b101, 0b111, 0b101}},
            {'X', {0b101, 0b101, 0b010, 0b101, 0b101}},
            {'Y', {0b101, 0b101, 0b010, 0b010, 0b010}},
            {'Z', {0b111, 0b001, 0b010, 0b100, 0b111}},

            // Lowercase letters (same as uppercase for simplicity)
            {'a', {0b010, 0b101, 0b111, 0b101, 0b101}},
            {'b', {0b110, 0b101, 0b110, 0b101, 0b110}},
            {'c', {0b011, 0b100, 0b100, 0b100, 0b011}},
            {'d', {0b110, 0b101, 0b101, 0b101, 0b110}},
            {'e', {0b111, 0b100, 0b110, 0b100, 0b111}},
            {'f', {0b111, 0b100, 0b110, 0b100, 0b100}},
            {'g', {0b011, 0b100, 0b101, 0b101, 0b011}},
            {'h', {0b101, 0b101, 0b111, 0b101, 0b101}},
            {'i', {0b111, 0b010, 0b010, 0b010, 0b111}},
            {'j', {0b001, 0b001, 0b001, 0b101, 0b010}},
            {'k', {0b101, 0b110, 0b100, 0b110, 0b101}},
            {'l', {0b100, 0b100, 0b100, 0b100, 0b111}},
            {'m', {0b101, 0b111, 0b101, 0b101, 0b101}},
            {'n', {0b101, 0b111, 0b111, 0b101, 0b101}},
            {'o', {0b010, 0b101, 0b101, 0b101, 0b010}},
            {'p', {0b110, 0b101, 0b110, 0b100, 0b100}},
            {'q', {0b010, 0b101, 0b101, 0b111, 0b011}},
            {'r', {0b110, 0b101, 0b110, 0b101, 0b101}},
            {'s', {0b011, 0b100, 0b010, 0b001, 0b110}},
            {'t', {0b111, 0b010, 0b010, 0b010, 0b010}},
            {'u', {0b101, 0b101, 0b101, 0b101, 0b010}},
            {'v', {0b101, 0b101, 0b101, 0b010, 0b010}},
            {'w', {0b101, 0b101, 0b101, 0b111, 0b101}},
            {'x', {0b101, 0b101, 0b010, 0b101, 0b101}},
            {'y', {0b101, 0b101, 0b010, 0b010, 0b010}},
            {'z', {0b111, 0b001, 0b010, 0b100, 0b111}},

            // Symbols
            {' ', {0b000, 0b000, 0b000, 0b000, 0b000}},
            {'.', {0b000, 0b000, 0b000, 0b000, 0b010}},
            {',', {0b000, 0b000, 0b000, 0b010, 0b100}},
            {':', {0b000, 0b010, 0b000, 0b010, 0b000}},
            {';', {0b000, 0b010, 0b000, 0b010, 0b100}},
            {'-', {0b000, 0b000, 0b111, 0b000, 0b000}},
            {'+', {0b000, 0b010, 0b111, 0b010, 0b000}},
            {'=', {0b000, 0b111, 0b000, 0b111, 0b000}},
            {'!', {0b010, 0b010, 0b010, 0b000, 0b010}},
            {'?', {0b110, 0b001, 0b010, 0b000, 0b010}},
            {'(', {0b001, 0b010, 0b010, 0b010, 0b001}},
            {')', {0b100, 0b010, 0b010, 0b010, 0b100}},
            {'[', {0b011, 0b010, 0b010, 0b010, 0b011}},
            {']', {0b110, 0b010, 0b010, 0b010, 0b110}},
            {'*', {0b000, 0b101, 0b010, 0b101, 0b000}},
            {'/', {0b001, 0b001, 0b010, 0b100, 0b100}},
            {'\\', {0b100, 0b100, 0b010, 0b001, 0b001}},
            {'_', {0b000, 0b000, 0b000, 0b000, 0b111}},
            {'<', {0b001, 0b010, 0b100, 0b010, 0b001}},
            {'>', {0b100, 0b010, 0b001, 0b010, 0b100}},
            {'#', {0b101, 0b111, 0b101, 0b111, 0b101}},
            {'@', {0b010, 0b101, 0b111, 0b100, 0b011}},
            {'%', {0b101, 0b001, 0b010, 0b100, 0b101}},
            {'^', {0b010, 0b101, 0b000, 0b000, 0b000}},
            {'&', {0b010, 0b101, 0b010, 0b101, 0b011}},
            {'$', {0b011, 0b110, 0b010, 0b011, 0b110}},
            {'\'', {0b010, 0b010, 0b000, 0b000, 0b000}},
            {'"', {0b101, 0b101, 0b000, 0b000, 0b000}},
            {'`', {0b100, 0b010, 0b000, 0b000, 0b000}},
            {'~', {0b000, 0b010, 0b101, 0b010, 0b000}},
            {'|', {0b010, 0b010, 0b010, 0b010, 0b010}},
        };
        return font;
    }

    /**
     * @brief Get the width of text in pixels
     * @param text Text to measure
     * @return Width in pixels (3 per char + 1 spacing, minus last spacing)
     */
    inline int textWidth(const std::string &text)
    {
        if (text.empty())
            return 0;
        return static_cast<int>(text.length()) * 4 - 1;
    }

    /**
     * @brief Get the height of text in pixels
     * @return Height in pixels (always 5 for 3x5 font)
     */
    inline constexpr int textHeight()
    {
        return 5;
    }

    /**
     * @brief Larger 5x7 glyph structure
     */
    struct LargeGlyph
    {
        uint8_t rows[7];

        constexpr LargeGlyph() : rows{0, 0, 0, 0, 0, 0, 0} {}
        constexpr LargeGlyph(uint8_t r0, uint8_t r1, uint8_t r2, uint8_t r3,
                             uint8_t r4, uint8_t r5, uint8_t r6)
            : rows{r0, r1, r2, r3, r4, r5, r6} {}
    };

    /**
     * @brief Get a larger 5x7 font for better readability
     */
    inline const std::map<char, LargeGlyph> &getLargeFont()
    {
        static std::map<char, LargeGlyph> font = {
            {'0', {0b01110, 0b10001, 0b10011, 0b10101, 0b11001, 0b10001, 0b01110}},
            {'1', {0b00100, 0b01100, 0b00100, 0b00100, 0b00100, 0b00100, 0b01110}},
            {'2', {0b01110, 0b10001, 0b00001, 0b00110, 0b01000, 0b10000, 0b11111}},
            {'3', {0b11111, 0b00010, 0b00100, 0b00010, 0b00001, 0b10001, 0b01110}},
            {'4', {0b00010, 0b00110, 0b01010, 0b10010, 0b11111, 0b00010, 0b00010}},
            {'5', {0b11111, 0b10000, 0b11110, 0b00001, 0b00001, 0b10001, 0b01110}},
            {'6', {0b00110, 0b01000, 0b10000, 0b11110, 0b10001, 0b10001, 0b01110}},
            {'7', {0b11111, 0b00001, 0b00010, 0b00100, 0b01000, 0b01000, 0b01000}},
            {'8', {0b01110, 0b10001, 0b10001, 0b01110, 0b10001, 0b10001, 0b01110}},
            {'9', {0b01110, 0b10001, 0b10001, 0b01111, 0b00001, 0b00010, 0b01100}},
            {'A', {0b01110, 0b10001, 0b10001, 0b11111, 0b10001, 0b10001, 0b10001}},
            {'B', {0b11110, 0b10001, 0b10001, 0b11110, 0b10001, 0b10001, 0b11110}},
            {'C', {0b01110, 0b10001, 0b10000, 0b10000, 0b10000, 0b10001, 0b01110}},
            {'D', {0b11110, 0b10001, 0b10001, 0b10001, 0b10001, 0b10001, 0b11110}},
            {'E', {0b11111, 0b10000, 0b10000, 0b11110, 0b10000, 0b10000, 0b11111}},
            {'F', {0b11111, 0b10000, 0b10000, 0b11110, 0b10000, 0b10000, 0b10000}},
            {'G', {0b01110, 0b10001, 0b10000, 0b10111, 0b10001, 0b10001, 0b01111}},
            {'H', {0b10001, 0b10001, 0b10001, 0b11111, 0b10001, 0b10001, 0b10001}},
            {'I', {0b01110, 0b00100, 0b00100, 0b00100, 0b00100, 0b00100, 0b01110}},
            {'J', {0b00111, 0b00010, 0b00010, 0b00010, 0b00010, 0b10010, 0b01100}},
            {'K', {0b10001, 0b10010, 0b10100, 0b11000, 0b10100, 0b10010, 0b10001}},
            {'L', {0b10000, 0b10000, 0b10000, 0b10000, 0b10000, 0b10000, 0b11111}},
            {'M', {0b10001, 0b11011, 0b10101, 0b10101, 0b10001, 0b10001, 0b10001}},
            {'N', {0b10001, 0b11001, 0b10101, 0b10011, 0b10001, 0b10001, 0b10001}},
            {'O', {0b01110, 0b10001, 0b10001, 0b10001, 0b10001, 0b10001, 0b01110}},
            {'P', {0b11110, 0b10001, 0b10001, 0b11110, 0b10000, 0b10000, 0b10000}},
            {'Q', {0b01110, 0b10001, 0b10001, 0b10001, 0b10101, 0b10010, 0b01101}},
            {'R', {0b11110, 0b10001, 0b10001, 0b11110, 0b10100, 0b10010, 0b10001}},
            {'S', {0b01111, 0b10000, 0b10000, 0b01110, 0b00001, 0b00001, 0b11110}},
            {'T', {0b11111, 0b00100, 0b00100, 0b00100, 0b00100, 0b00100, 0b00100}},
            {'U', {0b10001, 0b10001, 0b10001, 0b10001, 0b10001, 0b10001, 0b01110}},
            {'V', {0b10001, 0b10001, 0b10001, 0b10001, 0b10001, 0b01010, 0b00100}},
            {'W', {0b10001, 0b10001, 0b10001, 0b10101, 0b10101, 0b10101, 0b01010}},
            {'X', {0b10001, 0b10001, 0b01010, 0b00100, 0b01010, 0b10001, 0b10001}},
            {'Y', {0b10001, 0b10001, 0b01010, 0b00100, 0b00100, 0b00100, 0b00100}},
            {'Z', {0b11111, 0b00001, 0b00010, 0b00100, 0b01000, 0b10000, 0b11111}},
            {' ', {0b00000, 0b00000, 0b00000, 0b00000, 0b00000, 0b00000, 0b00000}},
        };
        return font;
    }

} // namespace font

TG_NAMESPACE_END
